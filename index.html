<html>
  <head>
    <title>Meu Client WebSocket</title>
    <script type="text/javascript" src="static/reconnecting-websocket.js"></script>
  </head>
  <body>
    <div id="mensagem">
    </div>
    <form onsubmit="return send();">
      <input type="text" id="input" /><button type="button" onclick="send()">Enviar</button>
    </form>
    <script type="text/javascript">
      var mensagens = 0;
      var usuario = prompt("Qual seu nome:", "");
      while (usuario == null) {
          usuario = prompt("Qual seu nome:", "");
      }
      var socket;
      // Usando Conex達o segura
      // socket = new WebSocket('wss://'+location.host+'/1');
      socket = new ReconnectingWebSocket('{{protocol}}://'+location.host+'/1', null, {debug: true, reconnectInterval: 3000});
      // N達o usando Conex達o segura
      //socket = new WebSocket('ws://'+location.host+'/1');
      socket.onerror = function(evento){
        console.log(evento);
      }
      socket.onopen = function(){
        console.log('Conex達o foi aberta!');
      }
      socket.onmessage = function(mensagem){
        console.log('Nova Mensagem:'+ mensagem.data);
        mensagens += 1;
        document.title = (mensagens + " - Meu Client WebSocket");
        document.getElementById('mensagem').innerHTML += "<br />"+mensagem.data;
      }
      var send = function(){
        var mensagem = document.getElementById('input').value;
        document.getElementById('mensagem').innerHTML += "<br />"+usuario+":"+mensagem;
        socket.send(usuario+":"+mensagem);
        document.getElementById('input').value = "";
        return false;
      }
      window.onfocus = function(){
        document.title = "Ok - Meu Client WebSocket";
        mensagens = 0;
      }
    </script>
  </body>
</html>
